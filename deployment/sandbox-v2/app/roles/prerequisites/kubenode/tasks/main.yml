- include_vars:
    file: roles/postgres/postgres/defaults/main.yml

- name: Create postgres data folder
  file:
    path: '{{postgres_local_storage_path}}'
    state: directory 

- include_vars:
    file: roles/config-server/defaults/main.yml

- name: Create git config repo dir 
  file:
    path: '{{config_repo_node_path}}' # Defined in role config-server
    state: directory 

- name: Copy all the properties from console to node 
  copy:
     src: '{{playbook_dir}}/roles/config-server/files/properties/'  
     dest: '{{config_repo_node_path}}' 
     force: no
    
- name: Install git 
  vars:
    ansible_python_interpreter: /usr/bin/python2.7 # Needed otherwise ansible not able to install
  yum:
    name: git
    state: present
    
- name: Git init
  command: 'git init' 
  args:
    chdir: '{{config_repo_node_path}}' 

- name: Git add
  command: 'git add .' 
  args:
    chdir: '{{config_repo_node_path}}' 

- name: Git add
  command:  'git -c user.email={{lookup("env", "USER")}}@mosip commit -m "Updated"' 
  args:
    chdir: '{{config_repo_node_path}}' 
  ignore_errors: yes

