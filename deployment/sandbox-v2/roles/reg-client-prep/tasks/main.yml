---
# Creates folder in nfs for reg-client to provide metadata.xml and mosip-cer file.
# These files are further used by reg-client downloader to create the client zip.

- name: Create reg client folder in nfs.
  file:
    path: '{{reg_prop.nfs_path}}'
    state: directory 
  become: yes

- name: Copy certificate
  template:
    src: '{{reg_client.cert_path}}/{{reg_client.cert_file}}'
    dest: '{{reg_client.nfs_path}}' 
  become: yes

- name: maven_metadata_xml_template to maven-metadata.xml 
  template:
    src: '{{reg_client.xml_file}}'
    dest: '{{reg_client.nfs_path}}'
  become: yes

# Note: The zip file below is pointed by nginx for external downloads
- name: Zip regclient keys and place them in tmp dir
  archive:
    path: '{{install_root}}/roles/reg-client-prep/files/regclientkeys/'
    dest: '{{tmp_dir}}/regclientkeys.zip'
    format: zip

- name: Set symlink to regclient keys zip file
  file: 
    src: '{{install_root}}/tmp/regclientkeys.zip'
    dest: '/usr/share/nginx/html/regclientkeys.zip'
    state: link
  become: yes

- name: Restart nginx
  command: 'systemctl restart nginx'
  become: yes
